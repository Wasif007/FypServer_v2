(function(){angular.module("pingFyp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,r){e.when("/signup",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/supervisor",{templateUrl:"/supervisor/supervisor.view.html",controller:"supervisorCtrl",controllerAs:"vm"}).when("/modules",{templateUrl:"/modules/modules.view.html",controllerAs:"vm",controller:"modulesCtrl"}).when("/addguard",{templateUrl:"/addguard/addguard.view.html",controller:"addguardCtrl",controllerAs:"vm"}).when("/history",{templateUrl:"/history/history.view.html",controller:"historyCtrl",controllerAs:"vm"}).when("/assign",{templateUrl:"/assign/assign.view.html",controller:"assignCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/login"});r.html5Mode(true)}function r(e,r,n){e.$on("$routeChangeStart",function(e,t,o){if(r.path()==="/profile"&&!n.isLoggedIn()){r.path("/")}})}angular.module("pingFyp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication",r])})();(function(){angular.module("pingFyp").controller("supervisorCtrl",e);function e(){var e=this}})();(function(){angular.module("pingFyp").controller("modulesCtrl",e);function e(){var e=this}})();(function(){angular.module("pingFyp").controller("assignCtrl",e);e.$inject=["assignedGuard","supervisorData","$window","$location"];function e(e,r,n,t){var o=this;o.credentials={time:"",location:"",guardUsername:"",guardImageUrl:"",supervisorName:"",supervisorImageUrl:"",guardName:""};r.getSuperVisor(n.localStorage["supervisor-email"]).success(function(r){o.data={supervisor:r};o.credentials.supervisorName=o.data.supervisor.name;o.credentials.supervisorImageUrl=o.data.supervisor.imageUrl;e.getListOfGuards().success(function(e){o.datas={guards:e}}).error(function(e){console.log(e)})}).error(function(e){console.log(e)});o.onSubmittion=function(){if(!o.credentials.supervisorName||!o.credentials.guardName||!o.credentials.supervisorImageUrl||!o.credentials.time||!o.credentials.location){o.formError="All fields required, please try again";return false}else{e.getGuardSpecificGuard(o.credentials.guardName).success(function(e){o.guardData={guard:e};o.credentials.guardImageUrl=o.guardData.guard.imageUrl;o.credentials.guardUsername=o.guardData.guard.email;o.assignDuty()}).error(function(e){o.message="Sorry, something's gone wrong"})}};o.assignDuty=function(){e.assigningDuty(o.credentials).error(function(e){o.formError=e}).then(function(){t.path("/supervisor")})}}})();(function(){angular.module("pingFyp").directive("fileModel",e);e.$inject=["$parse"];function e(e){return{restrict:"A",link:function(r,n,t){var o=e(t.fileModel);var i=o.assign;n.bind("change",function(){r.$apply(function(){i(r,n[0].files[0])})})}}}})();(function(){angular.module("pingFyp").service("multipartForm",e);e.$inject=["$http"];function e(e){this.post=function(r,n){var t=new FormData;for(var o in n)t.append(o,n[o]);return e.post(r,t,{transformRequest:angular.indentity,headers:{"Content-Type":undefined}}).success(function(e){console.log("DATA IS :"+e)})}}})();(function(){angular.module("pingFyp").controller("historyCtrl",e);function e(){var e=this}})();(function(){angular.module("pingFyp").service("assignedGuard",e);e.$inject=["$http"];function e(e){var r=function(){return e.get("/api/addingguard")};var n=function(r){return e.get("/api/guardData/"+r)};var t=function(r){return e.post("/api/assignDuty",r).success(function(e){console.log(e)})};return{getGuardSpecificGuard:n,getListOfGuards:r,assigningDuty:t}}})();(function(){angular.module("pingFyp").controller("addguardCtrl",e);e.$inject=["authentication","multipartForm","$location"];function e(e,r,n){var t=this;t.credentials={name:"",email:"",code:"",file:"",phone:"",home_address:""};t.onSubmit=function(){t.formError="";if(!t.credentials.name||!t.credentials.home_address||!t.credentials.file||!t.credentials.phone||!t.credentials.email||!t.credentials.code){t.formError="All fields required, please try again";return false}else{t.doAddGuard()}};t.doAddGuard=function(){t.formError="";var e="/api/addingguard";r.post(e,t.credentials).then(function(){n.path("/supervisor")})}}})();(function(){angular.module("pingFyp").controller("loginCtrl",e);e.$inject=["authentication","$location"];function e(e,r){var n=this;n.pageHeader={title:"Login in to PING"};n.credentials={email:"",password:""};n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doLogin()}};n.doLogin=function(){n.formError="";e.login(n.credentials).error(function(e){if(e.message="Incorrect Password"){n.formError="Password doesnot matches"}else{n.formError=e}}).then(function(){r.path("/supervisor")})}}})();(function(){angular.module("pingFyp").controller("registerCtrl",e);e.$inject=["authentication","multipartForm","$location"];function e(e,r,n){var t=this;t.pageHeader={title:"Create a new PING account"};t.credentials={name:"",email:"",password:"",file:"",phone:"",home_address:""};t.onSubmit=function(){t.formError="";if(!t.credentials.name||!t.credentials.home_address||!t.credentials.file||!t.credentials.phone||!t.credentials.email||!t.credentials.password){t.formError="All fields required, please try again";return false}else{t.doRegister()}};t.doRegister=function(){t.formError="";var e="/api/supervisorSignup";r.post(e,t.credentials).then(function(){n.path("/login")})}}})();(function(){angular.module("pingFyp").service("authentication",e);e.$inject=["$http","$window"];function e(e,r){var n=function(e){r.localStorage["ping-token"]=e};var t=function(e){r.localStorage["supervisor-email"]=e};var o=function(){return r.localStorage["ping-token"]};var i=function(){var e=o();if(e){var n=JSON.parse(r.atob(e.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}};var a=function(){if(i()){var e=o();var n=JSON.parse(r.atob(e.split(".")[1]));return{email:n.email,name:n.name}}};var s=function(){var e=o();var n=JSON.parse(r.atob(e.split(".")[1]));return n.email};register=function(r){console.log(r);return e.post("/api/supervisorSignup",r).success(function(e){n(e.token)})};login=function(r){return e.post("/api/supervisorLogin",r).success(function(e){n(e.token);t(s())})};posting=function(r,n){var t=new FormData;for(var o in n)t.append(o,n[o]);return e.post(r,t,{transformRequest:angular.indentity,headers:{"Content-Type":undefined}}).success(function(e){console.log("DATA IS :"+e)})};logout=function(){r.localStorage.removeItem("ping-token")};return{currentUser:a,saveToken:n,getToken:o,isLoggedIn:i,register:register,login:login,logout:logout}}})();(function(){angular.module("pingFyp").service("meanData",e);e.$inject=["$http","authentication"];function e(e,r){var n=function(){return e.get("/api/users",{headers:{Authorization:"Bearer "+r.getToken()}})};return{getProfile:n}}})();(function(){angular.module("pingFyp").service("supervisorData",e);e.$inject=["$http"];function e(e){var r=function(r){return e.get("/api/supervisorName/"+r)};return{getSuperVisor:r}}})();