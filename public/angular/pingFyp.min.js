(function(){angular.module("pingFyp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,r){e.when("/signup",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/supervisor",{templateUrl:"/supervisor/supervisor.view.html",controller:"supervisorCtrl",controllerAs:"vm"}).when("/modules",{templateUrl:"/modules/modules.view.html",controllerAs:"vm",controller:"modulesCtrl"}).when("/addguard",{templateUrl:"/addguard/addguard.view.html",controller:"addguardCtrl",controllerAs:"vm"}).when("/history",{templateUrl:"/history/history.view.html",controller:"historyCtrl",controllerAs:"vm"}).when("/assign",{templateUrl:"/assign/assign.view.html",controller:"assignCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/login"});r.html5Mode(true)}function r(e,r,n){e.$on("$routeChangeStart",function(e,t,i){if(r.path()==="/profile"&&!n.isLoggedIn()){r.path("/")}})}angular.module("pingFyp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication",r])})();(function(){angular.module("pingFyp").controller("supervisorCtrl",e);function e(){var e=this}})();(function(){angular.module("pingFyp").controller("modulesCtrl",e);function e(){var e=this}})();(function(){angular.module("pingFyp").controller("assignCtrl",e);e.$inject=["assignedGuard","supervisorData","$window"];function e(e,r,n){var t=this;t.credentials={time:""};e.getListOfGuards().success(function(e){t.datas={guards:e}}).error(function(e){t.message="Sorry, something's gone wrong, please try again later"});r.getListOfGuards(n.localStorage["supervisor-email"]).success(function(e){t.data={supervisor:e};t.credentials.supervisorName=t.data.supervisor.name;t.credentials.supervisorImageUrl=t.data.supervisor.imageUrl}).error(function(e){t.message="Sorry, something's gone wrong"});t.onSubmit=function(){if(!t.credentials.supervisorName||!t.credentials.guardName||!t.credentials.supervisorImageUrl||!t.credentials.guardImageUrl||!t.credentials.time||!t.credentials.location||!t.credentials.guardUsername){console.log("First Time "+t.credentials.supervisorName+" "+t.credentials.guardName+" "+t.credentials.supervisorImageUrl+" "+t.credentials.guardImageUrl+" "+t.credentials.time+" "+t.credentials.location+" "+t.credentials.guardUsername);t.formError="All fields required, please try again";return false}else{e.getGuardSpecificGuard(t.credentials.guardName).success(function(e){t.guardData={guard:e};t.credentials.guardImageUrl=t.guardData.guard.imageUrl;t.credentials.email=t.guardData.guard.email;console.log("Second Time "+t.credentials.supervisorName+" "+t.credentials.guardName+" "+t.credentials.supervisorImageUrl+" "+t.credentials.guardImageUrl+" "+t.credentials.time+" "+t.credentials.location+" "+t.credentials.guardUsername);t.assignDuty()}).error(function(e){t.message="Sorry, something's gone wrong"})}};t.assignDuty=function(){e.assigningDuty(t.credentials).error(function(e){t.formError=e}).then(function(){$location.path("/supervisor")})}}})();(function(){angular.module("pingFyp").directive("fileModel",e);e.$inject=["$parse"];function e(e){return{restrict:"A",link:function(r,n,t){var i=e(t.fileModel);var o=i.assign;n.bind("change",function(){r.$apply(function(){o(r,n[0].files[0])})})}}}})();(function(){angular.module("pingFyp").service("multipartForm",e);e.$inject=["$http"];function e(e){this.post=function(r,n){var t=new FormData;for(var i in n)t.append(i,n[i]);return e.post(r,t,{transformRequest:angular.indentity,headers:{"Content-Type":undefined}}).success(function(e){console.log("DATA IS :"+e)})}}})();(function(){angular.module("pingFyp").controller("historyCtrl",e);function e(){var e=this}})();(function(){angular.module("pingFyp").service("assignedGuard",e);e.$inject=["$http"];function e(e){var r=function(){return e.get("/api/addingguard")};var n=function(r){return e.get("/api/guardData/"+r)};var t=function(r){return e.post("/api/assignDuty").success(function(e){console.log(e)})};return{getGuardSpecificGuard:n,getListOfGuards:r,assigningDuty:t}}})();(function(){angular.module("pingFyp").controller("addguardCtrl",e);e.$inject=["authentication","multipartForm","$location"];function e(e,r,n){var t=this;t.credentials={name:"",email:"",code:"",file:"",phone:"",home_address:""};t.onSubmit=function(){t.formError="";if(!t.credentials.name||!t.credentials.home_address||!t.credentials.file||!t.credentials.phone||!t.credentials.email||!t.credentials.code){t.formError="All fields required, please try again";return false}else{t.doAddGuard()}};t.doAddGuard=function(){t.formError="";var e="/api/addingguard";r.post(e,t.credentials).then(function(){n.path("/supervisor")})}}})();(function(){angular.module("pingFyp").controller("loginCtrl",e);e.$inject=["authentication","$location"];function e(e,r){var n=this;n.pageHeader={title:"Login in to PING"};n.credentials={email:"",password:""};n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doLogin()}};n.doLogin=function(){n.formError="";e.login(n.credentials).error(function(e){if(e.message="Incorrect Password"){n.formError="Password doesnot matches"}else{n.formError=e}}).then(function(){r.path("/supervisor")})}}})();(function(){angular.module("pingFyp").controller("registerCtrl",e);e.$inject=["authentication","multipartForm","$location"];function e(e,r,n){var t=this;t.pageHeader={title:"Create a new PING account"};t.credentials={name:"",email:"",password:"",file:"",phone:"",home_address:""};t.onSubmit=function(){t.formError="";if(!t.credentials.name||!t.credentials.home_address||!t.credentials.file||!t.credentials.phone||!t.credentials.email||!t.credentials.password){t.formError="All fields required, please try again";return false}else{t.doRegister()}};t.doRegister=function(){t.formError="";var e="/api/supervisorSignup";r.post(e,t.credentials).then(function(){n.path("/login")})}}})();(function(){angular.module("pingFyp").service("authentication",e);e.$inject=["$http","$window"];function e(e,r){var n=function(e){r.localStorage["ping-token"]=e};var t=function(e){r.localStorage["supervisor-email"]=e};var i=function(){return r.localStorage["ping-token"]};var o=function(){var e=i();if(e){var n=JSON.parse(r.atob(e.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}};var a=function(){if(o()){var e=i();var n=JSON.parse(r.atob(e.split(".")[1]));return{email:n.email,name:n.name}}};var s=function(){var e=i();var n=JSON.parse(r.atob(e.split(".")[1]));return n.email};register=function(r){console.log(r);return e.post("/api/supervisorSignup",r).success(function(e){n(e.token)})};login=function(r){return e.post("/api/supervisorLogin",r).success(function(e){n(e.token);t(s())})};posting=function(r,n){var t=new FormData;for(var i in n)t.append(i,n[i]);return e.post(r,t,{transformRequest:angular.indentity,headers:{"Content-Type":undefined}}).success(function(e){console.log("DATA IS :"+e)})};logout=function(){r.localStorage.removeItem("ping-token")};return{currentUser:a,saveToken:n,getToken:i,isLoggedIn:o,register:register,login:login,logout:logout}}})();(function(){angular.module("pingFyp").service("meanData",e);e.$inject=["$http","authentication"];function e(e,r){var n=function(){return e.get("/api/users",{headers:{Authorization:"Bearer "+r.getToken()}})};return{getProfile:n}}})();(function(){angular.module("pingFyp").service("supervisorData",e);e.$inject=["$http"];function e(e){var r=function(r){return e.get("/api/supervisorName/"+r)};return{getListOfGuards:r}}})();